package data;


import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.lang.reflect.Array;
import java.net.HttpURLConnection;
import java.net.URL;

import org.json.*;

public class GeoCoords {
    public String response;

    public GeoCoords(String city) throws IOException {
        URL url = new URL(String.format("https://geocode-maps.yandex.ru/1.x/?apikey=40d1649f-0493-4b70-98ba-98533de7710b&geocode=Москва,%s&format=json", city));
        HttpURLConnection con = (HttpURLConnection) url.openConnection();
        con.setRequestMethod("GET");
        con.setConnectTimeout(5000);
        con.setReadTimeout(5000);
        BufferedReader in = new BufferedReader(
                new InputStreamReader(con.getInputStream()));
        String inputLine;
        StringBuffer content = new StringBuffer();
        while ((inputLine = in.readLine()) != null) {
            content.append(inputLine);
        }
        response = new String(content);
        in.close();
        con.disconnect();
    }

    public Double[] getCoords() {
        JSONObject obj = new JSONObject("{\"response\":{\"GeoObjectCollection\":{\"metaDataProperty\":{\"GeocoderResponseMetaData\":{\"request\":\"Москва, царицыно\",\"results\":\"10\",\"found\":\"7\"}},\"featureMember\":[{\"GeoObject\":{\"metaDataProperty\":{\"GeocoderMetaData\":{\"precision\":\"other\",\"text\":\"Россия, Москва, Замоскворецкая линия, метро Царицыно\",\"kind\":\"metro\",\"Address\":{\"country_code\":\"RU\",\"formatted\":\"Россия, Москва, Замоскворецкая линия, метро Царицыно\",\"Components\":[{\"kind\":\"country\",\"name\":\"Россия\"},{\"kind\":\"province\",\"name\":\"Центральный федеральный округ\"},{\"kind\":\"province\",\"name\":\"Москва\"},{\"kind\":\"locality\",\"name\":\"Москва\"},{\"kind\":\"route\",\"name\":\"Замоскворецкая линия\"},{\"kind\":\"metro\",\"name\":\"метро Царицыно\"}]},\"AddressDetails\":{\"Country\":{\"AddressLine\":\"Россия, Москва, Замоскворецкая линия, метро Царицыно\",\"CountryNameCode\":\"RU\",\"CountryName\":\"Россия\",\"AdministrativeArea\":{\"AdministrativeAreaName\":\"Москва\",\"Locality\":{\"LocalityName\":\"Москва\",\"Thoroughfare\":{\"ThoroughfareName\":\"Замоскворецкая линия\",\"Premise\":{\"PremiseName\":\"метро Царицыно\"}}}}}}}},\"name\":\"метро Царицыно\",\"description\":\"Замоскворецкая линия, Москва, Россия\",\"boundedBy\":{\"Envelope\":{\"lowerCorner\":\"37.660799 55.616997\",\"upperCorner\":\"37.677256 55.626309\"}},\"Point\":{\"pos\":\"37.669028 55.621653\"}}},{\"GeoObject\":{\"metaDataProperty\":{\"GeocoderMetaData\":{\"precision\":\"other\",\"text\":\"Россия, Москва, Южный административный округ, район Царицыно\",\"kind\":\"district\",\"Address\":{\"country_code\":\"RU\",\"formatted\":\"Россия, Москва, Южный административный округ, район Царицыно\",\"Components\":[{\"kind\":\"country\",\"name\":\"Россия\"},{\"kind\":\"province\",\"name\":\"Центральный федеральный округ\"},{\"kind\":\"province\",\"name\":\"Москва\"},{\"kind\":\"locality\",\"name\":\"Москва\"},{\"kind\":\"district\",\"name\":\"Южный административный округ\"},{\"kind\":\"district\",\"name\":\"район Царицыно\"}]},\"AddressDetails\":{\"Country\":{\"AddressLine\":\"Россия, Москва, Южный административный округ, район Царицыно\",\"CountryNameCode\":\"RU\",\"CountryName\":\"Россия\",\"AdministrativeArea\":{\"AdministrativeAreaName\":\"Москва\",\"Locality\":{\"LocalityName\":\"Москва\",\"DependentLocality\":{\"DependentLocalityName\":\"Южный административный округ\",\"DependentLocality\":{\"DependentLocalityName\":\"район Царицыно\"}}}}}}}},\"name\":\"район Царицыно\",\"description\":\"Южный административный округ, Москва, Россия\",\"boundedBy\":{\"Envelope\":{\"lowerCorner\":\"37.625037 55.610458\",\"upperCorner\":\"37.68694 55.640919\"}},\"Point\":{\"pos\":\"37.652768 55.627387\"}}},{\"GeoObject\":{\"metaDataProperty\":{\"GeocoderMetaData\":{\"precision\":\"other\",\"text\":\"Россия, Москва, Южный административный округ, район Бирюлёво Восточное, жилой комплекс Царицыно\",\"kind\":\"district\",\"Address\":{\"country_code\":\"RU\",\"formatted\":\"Россия, Москва, Южный административный округ, район Бирюлёво Восточное, жилой комплекс Царицыно\",\"Components\":[{\"kind\":\"country\",\"name\":\"Россия\"},{\"kind\":\"province\",\"name\":\"Центральный федеральный округ\"},{\"kind\":\"province\",\"name\":\"Москва\"},{\"kind\":\"locality\",\"name\":\"Москва\"},{\"kind\":\"district\",\"name\":\"Южный административный округ\"},{\"kind\":\"district\",\"name\":\"район Бирюлёво Восточное\"},{\"kind\":\"district\",\"name\":\"жилой комплекс Царицыно\"}]},\"AddressDetails\":{\"Country\":{\"AddressLine\":\"Россия, Москва, Южный административный округ, район Бирюлёво Восточное, жилой комплекс Царицыно\",\"CountryNameCode\":\"RU\",\"CountryName\":\"Россия\",\"AdministrativeArea\":{\"AdministrativeAreaName\":\"Москва\",\"Locality\":{\"LocalityName\":\"Москва\",\"DependentLocality\":{\"DependentLocalityName\":\"Южный административный округ\",\"DependentLocality\":{\"DependentLocalityName\":\"район Бирюлёво Восточное\",\"DependentLocality\":{\"DependentLocalityName\":\"жилой комплекс Царицыно\"}}}}}}}}},\"name\":\"жилой комплекс Царицыно\",\"description\":\"район Бирюлёво Восточное, Южный административный округ, Москва, Россия\",\"boundedBy\":{\"Envelope\":{\"lowerCorner\":\"37.656748 55.60313\",\"upperCorner\":\"37.667869 55.607997\"}},\"Point\":{\"pos\":\"37.661994 55.605704\"}}},{\"GeoObject\":{\"metaDataProperty\":{\"GeocoderMetaData\":{\"precision\":\"other\",\"text\":\"Россия, Москва, музей-заповедник Царицыно\",\"kind\":\"vegetation\",\"Address\":{\"country_code\":\"RU\",\"formatted\":\"Россия, Москва, музей-заповедник Царицыно\",\"Components\":[{\"kind\":\"country\",\"name\":\"Россия\"},{\"kind\":\"province\",\"name\":\"Центральный федеральный округ\"},{\"kind\":\"province\",\"name\":\"Москва\"},{\"kind\":\"locality\",\"name\":\"Москва\"},{\"kind\":\"vegetation\",\"name\":\"музей-заповедник Царицыно\"}]},\"AddressDetails\":{\"Country\":{\"AddressLine\":\"Россия, Москва, музей-заповедник Царицыно\",\"CountryNameCode\":\"RU\",\"CountryName\":\"Россия\",\"AdministrativeArea\":{\"AdministrativeAreaName\":\"Москва\",\"Locality\":{\"LocalityName\":\"Москва\",\"Premise\":{\"PremiseName\":\"музей-заповедник Царицыно\"}}}}}}},\"name\":\"музей-заповедник Царицыно\",\"description\":\"Москва, Россия\",\"boundedBy\":{\"Envelope\":{\"lowerCorner\":\"37.669854 55.60431\",\"upperCorner\":\"37.697873 55.621867\"}},\"Point\":{\"pos\":\"37.684102 55.61266\"}}},{\"GeoObject\":{\"metaDataProperty\":{\"GeocoderMetaData\":{\"precision\":\"other\",\"text\":\"Россия, Москва, поселение Роговское, СНТ Царицыно\",\"kind\":\"locality\",\"Address\":{\"country_code\":\"RU\",\"formatted\":\"Россия, Москва, поселение Роговское, СНТ Царицыно\",\"Components\":[{\"kind\":\"country\",\"name\":\"Россия\"},{\"kind\":\"province\",\"name\":\"Центральный федеральный округ\"},{\"kind\":\"province\",\"name\":\"Москва\"},{\"kind\":\"area\",\"name\":\"Троицкий административный округ\"},{\"kind\":\"area\",\"name\":\"поселение Роговское\"},{\"kind\":\"locality\",\"name\":\"СНТ Царицыно\"}]},\"AddressDetails\":{\"Country\":{\"AddressLine\":\"Россия, Москва, поселение Роговское, СНТ Царицыно\",\"CountryNameCode\":\"RU\",\"CountryName\":\"Россия\",\"AdministrativeArea\":{\"AdministrativeAreaName\":\"Москва\",\"SubAdministrativeArea\":{\"SubAdministrativeAreaName\":\"Троицкий административный округ\",\"Locality\":{\"LocalityName\":\"СНТ Царицыно\"}}}}}}},\"name\":\"СНТ Царицыно\",\"description\":\"поселение Роговское, Москва, Россия\",\"boundedBy\":{\"Envelope\":{\"lowerCorner\":\"36.975286 55.214666\",\"upperCorner\":\"36.984943 55.221784\"}},\"Point\":{\"pos\":\"36.978673 55.217819\"}}},{\"GeoObject\":{\"metaDataProperty\":{\"GeocoderMetaData\":{\"precision\":\"other\",\"text\":\"Россия, Москва, Южный административный округ, район Бирюлёво Восточное, жилой комплекс Царицыно-2\",\"kind\":\"district\",\"Address\":{\"country_code\":\"RU\",\"formatted\":\"Россия, Москва, Южный административный округ, район Бирюлёво Восточное, жилой комплекс Царицыно-2\",\"Components\":[{\"kind\":\"country\",\"name\":\"Россия\"},{\"kind\":\"province\",\"name\":\"Центральный федеральный округ\"},{\"kind\":\"province\",\"name\":\"Москва\"},{\"kind\":\"locality\",\"name\":\"Москва\"},{\"kind\":\"district\",\"name\":\"Южный административный округ\"},{\"kind\":\"district\",\"name\":\"район Бирюлёво Восточное\"},{\"kind\":\"district\",\"name\":\"жилой комплекс Царицыно-2\"}]},\"AddressDetails\":{\"Country\":{\"AddressLine\":\"Россия, Москва, Южный административный округ, район Бирюлёво Восточное, жилой комплекс Царицыно-2\",\"CountryNameCode\":\"RU\",\"CountryName\":\"Россия\",\"AdministrativeArea\":{\"AdministrativeAreaName\":\"Москва\",\"Locality\":{\"LocalityName\":\"Москва\",\"DependentLocality\":{\"DependentLocalityName\":\"Южный административный округ\",\"DependentLocality\":{\"DependentLocalityName\":\"район Бирюлёво Восточное\",\"DependentLocality\":{\"DependentLocalityName\":\"жилой комплекс Царицыно-2\"}}}}}}}}},\"name\":\"жилой комплекс Царицыно-2\",\"description\":\"район Бирюлёво Восточное, Южный административный округ, Москва, Россия\",\"boundedBy\":{\"Envelope\":{\"lowerCorner\":\"37.650666 55.60311\",\"upperCorner\":\"37.657368 55.606995\"}},\"Point\":{\"pos\":\"37.653846 55.605215\"}}},{\"GeoObject\":{\"metaDataProperty\":{\"GeocoderMetaData\":{\"precision\":\"other\",\"text\":\"Россия, Москва, Южный административный округ, район Царицыно, жилой комплекс Счастье в Царицыно\",\"kind\":\"district\",\"Address\":{\"country_code\":\"RU\",\"formatted\":\"Россия, Москва, Южный административный округ, район Царицыно, жилой комплекс Счастье в Царицыно\",\"Components\":[{\"kind\":\"country\",\"name\":\"Россия\"},{\"kind\":\"province\",\"name\":\"Центральный федеральный округ\"},{\"kind\":\"province\",\"name\":\"Москва\"},{\"kind\":\"locality\",\"name\":\"Москва\"},{\"kind\":\"district\",\"name\":\"Южный административный округ\"},{\"kind\":\"district\",\"name\":\"район Царицыно\"},{\"kind\":\"district\",\"name\":\"жилой комплекс Счастье в Царицыно\"}]},\"AddressDetails\":{\"Country\":{\"AddressLine\":\"Россия, Москва, Южный административный округ, район Царицыно, жилой комплекс Счастье в Царицыно\",\"CountryNameCode\":\"RU\",\"CountryName\":\"Россия\",\"AdministrativeArea\":{\"AdministrativeAreaName\":\"Москва\",\"Locality\":{\"LocalityName\":\"Москва\",\"DependentLocality\":{\"DependentLocalityName\":\"Южный административный округ\",\"DependentLocality\":{\"DependentLocalityName\":\"район Царицыно\",\"DependentLocality\":{\"DependentLocalityName\":\"жилой комплекс Счастье в Царицыно\"}}}}}}}}},\"name\":\"жилой комплекс Счастье в Царицыно\",\"description\":\"район Царицыно, Южный административный округ, Москва, Россия\",\"boundedBy\":{\"Envelope\":{\"lowerCorner\":\"37.66689 55.627631\",\"upperCorner\":\"37.668174 55.628434\"}},\"Point\":{\"pos\":\"37.667519 55.628098\"}}}]}}}");
        String coords = obj.getJSONObject("response").getJSONObject("GeoObjectCollection").getJSONArray("featureMember").getJSONObject(0).getJSONObject("GeoObject").getJSONObject("Point").getString("pos");
        String[] arr_coords = coords.split(" ");
        String lat = Array.get(arr_coords, 0).toString();
        String lon = Array.get(arr_coords, 0).toString();
        Double[] city_coords = {Double.parseDouble(lat), Double.parseDouble(lon)};
        return city_coords;

    }
}
